# 代理模式作业 2019-03-10

## 定义
是指为其他对象提供一种代理，以控制对这个对象的访问。代理对象在客户端和目标对象之间起到中介作用。
使用代理模式对象的目的是：一保护目标对象；二增强目标对象。属于结构型设计模式。

## JDKProxy代理
- 拿到被代理对象的引用，获取其所有接口
- 生成一个新的类，新类实现所有被代理类的所有接口
- 动态生成java类，将所有增强的方法加到新的类中
- 编译运行java代码，并重新加载到JVM中，调用新类的方法运行。

## 为什么JDK动态代理中要求目标类实现的接口数量不能超过65535个
在class类的文件中，接口的个数是用4位16进制数表示的，最大为 2^16 - 1,也就是65535.

由于Class文件中方法，字段等都需要引用CONSTAN_Utf8_info型常量来描述名称，
所以CONSTAN_Utf8_info类型常量的最大长度也就是Java方法，字段名的最大长度。
而这里的最大长度就是length的最大值，既u2类型能表达的最大值65535.
所以Java程序中如果定义了超过64KB英文字符的变量和方法名，将会无法编译。

生成的代理类不得超过施加的任何限制在虚拟机的类上。 例如, VM 可能会限制
类可以实现到65535的接口数;在在这种情况下, {@code 接口} 数组的大小不能
超过65535

## Cglib
CGLib 动态代理执行代理方法效率之所以比 JDK 的高是因为 Cglib 采用了 FastClass 机
制，它的原理简单来说就是：为代理类和被代理类各生成一个 Class，这个 Class 会为代
理类或被代理类的方法分配一个 index(int 类型)。这个 index 当做一个入参，FastClass
就可以直接定位要调用的方法直接进行调用，这样省去了反射调用，所以调用效率比 JDK
动态代理通过反射调用高
   
FastClass是在执行MethodProxy invoke\invokeSuper时生成得并放在缓存中。  

## 重构业务代码


